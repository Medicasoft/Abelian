input {
  file {
    path => ["/vagrant/samples/postfix/mail.*"]
    type => "postfix"
    sincedb_path => "$HOME/.sincedb"
  }
}
filter {
  if [type] == "postfix" {
    grok {
      patterns_dir => ["./patterns"]
      match => [ "message", "%{POSTFIX}" ]
      add_tag => [ "postfix", "grokked", "%{component}" ]
    }
    if "qmgr" in [tags] {
      grok {
        patterns_dir => ["./patterns"]
        match => [ "message", "%{POSTFIXQMGR}" ]
      }
    }
    date {
      match => [ "timestamp", "MMM dd HH:mm:ss", "MMM  d HH:mm:ss" ]
      add_tag => [ "dated" ]
    }
  }
}
output {
  stdout { }
  if [type] == "postfix" {
	  elasticsearch {
		cluster => "logstash_cluster"
		embedded => false
		host => localhost
		node_name => "logstash_node"
		protocol => "http"
	  }
  }
}

